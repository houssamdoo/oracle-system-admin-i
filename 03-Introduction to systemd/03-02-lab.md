# Lab for systemd based on bash backup script
In this lab, we will create a simple bash script to back up a directory and then set up a systemd service and timer to run the backup script automatically at regular intervals.
## Step 1: Create a Backup Script
1. Open a terminal and create a new bash script file:
   ```bash
   nano /usr/local/bin/backup.sh
   ```
2. Add the following content to the script:
   ```bash
   #!/bin/bash
   # Backup script to back up /home/user/data to /home/user/backup
   SOURCE_DIR="/home/user/data"
   BACKUP_DIR="/home/user/backup"
   TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
   BACKUP_FILE="$BACKUP_DIR/backup_$TIMESTAMP.tar.gz"

   # Create the backup directory if it doesn't exist
   mkdir -p "$BACKUP_DIR"

   # Create a compressed archive of the source directory
   tar -czf "$BACKUP_FILE" -C "$SOURCE_DIR" .

   # Print a message indicating the backup was successful
   echo "Backup of $SOURCE_DIR completed successfully."
   ```
3. Save the file and exit the editor (in nano, press `CTRL + X`, then `Y`, then `ENTER`).
4. Make the script executable:
   ```bash
   chmod +x /usr/local/bin/backup.sh
   ```
## Step 2: Create a systemd Service
1. Create a new systemd service file:
   ```bash
   sudo nano /etc/systemd/system/backup.service
   ```
2. Add the following content to the service file:
   ```ini
   [Unit]
   Description=Backup Service
   After=network.target

   [Service]
   Type=oneshot
   ExecStart=/usr/local/bin/backup.sh

   [Install]
   WantedBy=multi-user.target
   ```
3. Save the file and exit the editor.
## Step 3: Create a systemd Timer
1. Create a new systemd timer file:
   ```bash
   sudo nano /etc/systemd/system/backup.timer
   ```
2. Add the following content to the timer file:
   ```ini
   [Unit]
   Description=Run Backup Service every day at midnight

   [Timer]
   OnCalendar=*-*-* 00:00:00
   Persistent=true

   [Install]
   WantedBy=timers.target
   ```
3. Save the file and exit the editor.
4. Reload the systemd daemon to recognize the new service and timer:
   ```bash
   sudo systemctl daemon-reload
   ```
5. Enable and start the timer:
   ```bash
   sudo systemctl enable --now backup.timer
   ```
## Step 4: Verify the Setup
1. Check the status of the timer to ensure it is active:
   ```bash
   systemctl status backup.timer
   ```
2. You can also check the next scheduled run time:
   ```bash
   systemctl list-timers --all
   ```
3. To test the backup script immediately, you can start the service manually:
   ```bash
   sudo systemctl start backup.service
   ```
4. Verify that the backup file has been created in the `/home/user/backup` directory.
